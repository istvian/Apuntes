# Usuarios

No todos los usuarios pueden acceder a los mismos privilegios.

## Creación de usuario

```
sql
CREATE USER usuario1 identified by 123 default tablespace users;
```

## Ver los usuarios
Para ver que usuarios existen


```sql
SELECT username, default_tablespace, created from dba_users;
```

Para conectarnos con el nuevo usuario creado, se le debe conceder el privilegio * connect *

```sql
grant connect to usuario1;
```

> [!NOTE]
> Grant = Permitir

## Probar conexión con usuario1

## Borrar un usuario
Se utiliza la sentencia drop user (más la cláusula cascade que elimina los objetos dentro del usuario).

Si el usuario estuviera conectado, se debe desconectar antes, haciendo click derecho en su conexión y luego elegir desconectar.

```sql
drop user usuario1 cascade;
```

## Ejercicio propuesto
Crear los usuarios digitador y cajero. Darles privilegio de conexión.

```sql
CREATE USER digitador identified by 123 default tablespace users;
CREATE USER cajero identified by 123 default tablespace users;

grant connect to digitador;
grant connect to cajero;

SELECT username, default_tablespace, created from dba_users;

```

## Uso de roles

Los usuarios creados no pueden hacer nada más que conectarse. Porque falta darle privilegios o permisos. 

(Utilizar Script)

```SQL
create table Camioneros(
RutCamionero varchar2(12) not null primary key,
NomCam varchar2(20),
ApPatCam varchar2(20),
ApMatCam varchar2(20),
FonoCam varchar2(10),
Sueldo number(9)
);
Create table Camiones(
Patente varchar2(6) not null primary key,
Marca varchar2(20),
Modelo varchar2(20),
Color varchar2(15),
Año number(4)
);
Create table ClienteDestino(
RutCliente varchar2(12) not null primary key,
NomCli varchar2(30),
ApPatCli varchar2(20),
ApMatCli varchar2(20),
FonoCli varchar2(10)
);
Create table Encomiendas(
CodEncomienda number(8) not null primary key,
PesoGr number(5),
Costo number(6),
Ciudad varchar2(30),
FechaEnvio date,
RutCli varchar2(12) not null references clientedestino,
RutCam varchar2(12) not null references camioneros,
Patente varchar2(6) not null references camiones
);

insert into camioneros values('10546789-4','Juan','Lara','Soto','64758999' ,340000);
insert into camioneros values('11328988-0','Mario','Donoso','Vera','53647800',350000);
insert into camioneros values('10324879-3','Luis','Díaz','Castro','43769034',340000);
insert into camioneros values('9678321-7', 'Mario','Donoso','Zapata','32879980',350000);

insert into camiones values('CTFT45','Ford','Cargo','Blanco',2010);
insert into camiones values('DFGR35','Mercedes Benz','Zetros','Negro',2011);
insert into camiones values('DRTQ87','Renault','Maxity','Blanco',2010);

insert into clienteDestino values('12867967-2','Carolina','Riquelme','Duarte','947528596');
insert into clienteDestino values('13437856-1','Eliana','Godoy','Urrutia','939881765');
insert into clienteDestino values('9768345-6','Carlos','Núñez','Torres','965639011');
insert into clienteDestino values('10769800-6','Paula','Millar','Salas','985619675');
insert into clienteDestino values('11341560-k','Marco','Vera','Carrillo','992039100');
insert into clienteDestino values('20900289-2','Lorena','Parra','Mora','945879826');

insert into encomiendas values(1,2380,52000,'Calama','13/10/2023','13437856-1','11328988-0','CTFT45');
insert into encomiendas values(2,1450,75000,'Arica','22/10/2023','12867967-2','10546789-4','DFGR35');
insert into encomiendas values(3,2130,23000,'Curicó','25/10/2023','9768345-6','9678321-7','CTFT45');
insert into encomiendas values(4,1569,30000,'Valdivia','25/10/2023','12867967-2','10324879-3','DRTQ87');
insert into encomiendas values(5,2176,25000,'Santiago','26/10/2023','13437856-1','11328988-0','DFGR35');
insert into encomiendas values(6,3343,28000,'Santiago','27/10/2023','11341560-k','10546789-4','DRTQ87');
insert into encomiendas values(7,2330,28000,'Curicó','3/11/2023','9768345-6','9678321-7','DRTQ87');
insert into encomiendas values(8,5890,56000,'Valdivia','5/11/2023','12867967-2','10324879-3','CTFT45');
insert into encomiendas values(9,8750,65000,'Arica','7/11/2023','12867967-2','11328988-0','DRTQ87');
insert into encomiendas values(10,8906,45000,'Santiago','11/11/2023','10769800-6','10546789-4','CTFT45');
insert into encomiendas values(11,8130,33000,'Curicó','12/11/2023','9768345-6','11328988-0','DRTQ87');
insert into encomiendas values(12,5680,62000,'Calama','13/11/2023','20900289-2','9678321-7','DFGR35');
insert into encomiendas values(13,4530,38000,'Curicó','15/11/2023','9768345-6', '11328988-0','DFGR35');
insert into encomiendas values(14,9890,66000,'Valdivia','17/11/2023','12867967-2','9678321-7','DRTQ87');
insert into encomiendas values(15,3976,45000,'Santiago','17/11/2023','13437856-1','10546789-4','DFGR35');
insert into encomiendas values(16,5460,65000,'Arica','20/11/2023','12867967-2','10546789-4','CTFT45');
insert into encomiendas values(17,5900,67000,'Calama','21/11/2023','20900289-2','9678321-7','CTFT45');
insert into encomiendas values(18,7866,58000,'Curicó','22/11/2023','9768345-6', '11328988-0','DFGR35');
insert into encomiendas values(19,7800,56000,'Valdivia','24/11/2023','12867967-2','9678321-7','CTFT45');
insert into encomiendas values(20,4890,35000,'Santiago','25/11/2023','13437856-1','10546789-4', 'DRTQ87');
insert into encomiendas values(21,7800,75000,'Arica','25/11/2023','12867967-2','9678321-7','CTFT45');
insert into encomiendas values(22,6080,68000,'Calama','26/11/2023','20900289-2','11328988-0','DRTQ87');
insert into encomiendas values(23,8945,64000,'Curicó','27/11/2023','9768345-6','10546789-4','DFGR35');
insert into encomiendas values(24,9800,43000,'Valdivia','28/11/2023','12867967-2','10324879-3','CTFT45');
insert into encomiendas values(25,6800,45000,'Santiago','29/11/2023','13437856-1','11328988-0', 'DRTQ87');



```

Los permisos pueden darse de forma independiente, pero para no repetir, hay que crear paquetes de permisos.

> [TIP]
> Un rol es un paquete de permiso.

Al crear un rol X, se lo puedo asignar a distintas personas de forma más fácil y rápida.


Antes de crear roles, haremos una prueba:

- Conectarse como digitador

```SQL
SELECT * FROM SYSTEM.ENCOMIENDAS;
-- USUARIO DIGITADOR NO TIENE PERMISOS PARA EJECUTAR NI SIQUIERA UN SELECT
```

<img width="481" height="145" alt="image" src="https://github.com/user-attachments/assets/9fc726e1-f14e-4308-af27-42e0f92d6d39" />

## Asignación de roles o privilegios

```SQL
-- Crear un rol vacio
CREATE ROLE INGRESOS;
-- Agregar permisos al rol
GRANT SELECT, INSERT ON ENCOMIENDAS TO INGRESOS;
-- ASIGNAR EL ROL INGRESO A DIGITADOR
GRANT INGRESOS TO DIGITADOR;
-- SE PUEDE ASIGNAR A VARIOS USUARIOS
-- GRANT INGRESOS TO DIGITADOR, CAJERO, ETC;

-- PARA CONFIRMAR EN SYSTEM
SELECT * FROM DBA_ROLE_PRIVS WHERE GRANTEE='DIGITADOR';
```

> [!IMPORTANT]
> Si vamos al usuario digitador... no se ven reflejados en el momento los cambios, hay que desconectar y luego conectar nuevamente para que se apliquen los cambios

Desconectar y conectar al usuario digitador y ejecutar lo siguiente:

```SQL
SELECT * FROM SYSTEM.ENCOMIENDAS;
INSERT INTO SYSTEM.ENCOMIENDAS VALUES(26,2300,5000,'Arica','4/12/2021', '9768345-6','10546789-4', 'CTFT45');
```
