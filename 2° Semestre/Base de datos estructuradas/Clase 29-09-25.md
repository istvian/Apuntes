# Funciones grupales

## SUM
```SQL
SELECT SUM(COSTOCOMPRA) FROM COMPRAS;
```

## AVG
```SQL
SELECT AVG(COSTOCOMPRA) PROMEDIO FROM COMPRAS;

-- SE USA ROUND PARA REDONDEAR
SELECT ROUND(AVG(COSTOCOMPRA),2) PROMEDIO FROM COMPRAS;
```

## MIN
Muestra el menor valor del campo

```SQL
SELECT MIN(COSTOCOMPRA) MINIMO FROM COMPRAS;
```

Si es en fecha, busca la más antigua.

## MAX
Obtener el mayor costo de compra

```sql
SELECT MAX(COSTOCOMPRA) MAYOR FROM COMPRAS;
```

En fechas devuelve la fecha más nueva (la última).

## COUNT
Calcula la cantidad de valores o cuenta

```sql
SELECT COUNT(FONOPER) CANTIDAD FROM PERSONAS;
```

Para contar la cantidad de registros hay en una tabla

```sql
SELECT COUNT(*) FROM PERSONAS;
```

Mostrar la suma de costos de compra para el equipo con codigo DRF54

```sql
SELECT SUM(COSTOCOMPRA) FROM COMPRAS WHERE CODEQUIPO='DRF54';
```

Mostrar primera compra del mes de junio

```sql
SELECT MIN(FECHACOMPRA) FROM COMPRAS WHERE fechacompra LIKE '%/06/23';

SELECT MIN(FECHACOMPRA) FROM COMPRAS WHERE EXTRACT(MONTH FROM FECHACOMPRA)= '6';

```

# Agrupamiento de datos con GROUP BY y HAVING

## GROUP BY

Se hace un resumen o consolidado de una tabla. Ej: Saber el total de ventas por ciudad. Elegir una funcion que voy a hacer.
Sumarlas? Promedio? Mayor? Menor? Contar? => Quiero que me muestre el nombre de la ciudad.

Permite agrupar los datos de salida por uno o mas campos que estan en la primera linea del select, ademas se debe estqar usando, al menos, una función grupal.


Mostrar el rut y la suma de pagos, agrupado por rut

```sql
SELECT RUTPROF, SUM(MONTO) SUMADEPAGOS FROM PAGOSAPROFESORES GROUP BY RUTPROF;

-- SE AGREGA CONDICION
SELECT RUTPROF, SUM(MONTO) SUMADEPAGOS
FROM PAGOSAPROFESORES
WHERE CODIGOASIGN ='as3000'
GROUP BY RUTPROF;


```

> [!IMPORTANT]
> SELECT, FROM, WHERE SIEMPRE VAN JUNTOS, NO SE SEPARAN. NO PUEDE SER SELECT, FROM, GROUP BY, WHERE

MOSTRAR LOS SEMESTRES, MESES Y SUMA DE MONTOS CON MESES ENTRE JUNIO Y OCTUBRE, AGRUPANDO Y ORDENANDO POR SEMESTRE Y MES

```SQL
SELECT SEMESTRE, MES, SUM(MONTO) SUMADEMONTOS FROM PAGOSAPROFESORES WHERE MES BETWEEN 6 AND 10 GROUP BY SEMESTRE, MES ORDER BY SEMESTRE, MES;
```

> [!IMPORTANT]
> AL HACER UN GROUP BY, EL GROUP BY DEBE CONTENER LOS MISMOS CAMPOS QUE EL SELECT SINO DA ERROR

## HAVING

PERMITE DEFINIR CONDICIONES DE SALIDA, SIMILAR AL WHERE, PERO USANDO LAS FUNCIONES GRUPALES DE REGISTROS(SUM, AVG, COUNT, MAX, MIN)

MOSTRAR EL RUT DE PROFESORES Y LA SUMA DE LOS MONTOS DE AQUELLOS EN QUE LA SUMA DE LOS MONTOS ES 700000 O MÁS AGRUPADO TODO POR RUT DE PROFESOR

```SQL
SELECT RUTPROF, SUM(MONTO) SUMADEMONTOS
FROM PAGOSAPROFESORES
GROUP BY RUTPROF
HAVING SUM(MONTO)>=700000;
```

WHERE CONSULTA LOS CAMPOS
HAVING CONSULTA A LA SUM, AVG, ETC

WHERE Y HAVING SE PODRIAN USAR SIMULTANEAMENTE, COMO EN EL SIGUIENTE EJEMPLO:

MOSTRAR EL RUT DE PROFESORES Y EL PROMDEIO DE LOS MONTOS, DE AQUELLOS PROFESORES CON MONTOS MAYORES A 80000 Y EN QUE LA SUMA DE LOS MONTOS ES 300000 O MÁS, TODO AGRUPADO POR RUT PROFESOR

```SQL
SELECT RUTPROF, AVG(MONTO) PROMEDIO
FROM PAGOSAPROFESORES
WHERE MONTO > 80000
GROUP BY RUTPROF
HAVING SUM(MONTO) >= 300000;

-- ORDENAR POR EL PROMEDIO
SELECT RUTPROF, AVG(MONTO) PROMEDIO
FROM PAGOSAPROFESORES
WHERE MONTO > 80000
GROUP BY RUTPROF
HAVING SUM(MONTO) >= 300000
ORDER BY AVG(MONTO);
```

## EJERCICIOS PROPUESTOS

MOSTRAR RUT DE PROFESOR Y EL MENOR MONTO PAGADO, TODO AGRUPADO POR RUT DEL PROFESOR

```SQL
SELECT RUTPROF, MIN(MONTO) FROM PAGOSAPROFESORES GROUP BY RUTPROF;
```

2) MOSTRAR EL RUT DE PROFESOR, LA SUMA DE SUS MONTOS PAGADOS Y LA CANTIDAD DE PAGOS, TODO AGRUPADO POR RUT DE PROFESOR Y ORDENADO POR LA SUMA DE MONTOS

```SQL
SELECT RUTPROF, SUM(MONTO), COUNT(MONTO) FROM PAGOSAPROFESORES GROUP BY RUTPROF ORDER BY SUM(MONTO);
```

3) MOSTRAR EL MES CON EL PROMEDIO DE LOS MONTOS PAGADOS QUE SEAN DE LA ASIGNATURA AS2000, TODO AGRUPADO POR MES Y ORDENADO POR MES

```SQL
SELECT MES, AVG(MONTO) FROM PAGOSAPROFESORES WHERE CODIGOASIGN = 'as2000' GROUP BY MES ORDER BY MES;
```

4) MOSTRAR LOS MESES MAYORES AL 7 Y LOS PROMEDIOS DE MONTOS PAGADOS MAYORESW A 80000, TODO AGRUPADO POR MES.

```SQL
SELECT MES, AVG(MONTO) FROM PAGOSAPROFESORES WHERE MES > 7 GROUP BY MES HAVING AVG(MONTO) >80000;
```

5) OBTENER EL MES Y EL MAYOR MONTO PAGADO EN CADA MES, AGRUPAR Y ORDENAR POR MES

```SQL
SELECT MES, MAX(MONTO) FROM PAGOSAPROFESORES GROUP BY MES ORDER BY MES;
```
