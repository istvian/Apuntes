# Indices

La busqueda siempre es secuencial, pero si hay un indice va directo al resultado.

Los indices se ocupan cuando hay una gran cantidad de registros (miles o más)

```SQL
create table transporte(
patente varchar2(6) not null primary key,
marca varchar2(20),
modelo varchar2(20),
color varchar2(15)
);
create table encomienda(
codEnc number(8) not null primary key,
peso number(5),  --en gr
costo number(6),
fecha date,
patenteTransp varchar2(6) not null references transporte
);
insert into transporte values('CTFT45','Ford','Cargo','Blanco');
insert into transporte values('DFGR35','Mercedes Benz','Zetros','Negro');
insert into transporte values('DRTQ87','Renault','Maxity','Blanco');
insert into encomienda values(1,2380,12000,'13/10/2023','CTFT45');
insert into encomienda values(2,1450,35000,'22/10/2023','DFGR35');
insert into encomienda values(3,2130,23000,'25/10/2023','CTFT45');
insert into encomienda values(4,1569,30000,'25/10/2023','DRTQ87');
insert into encomienda values(5,2176,15000,'26/10/2023','DFGR35');
```

Usando el Diccionario de Datos, para ver que indices hay en una tabla, se escribe:

```SQL
SELECT INDEX_NAME FROM ALL_INDEXES WHERE TABLE_NAME='ENCOMIENDA';
```

<img width="286" height="103" alt="image" src="https://github.com/user-attachments/assets/70011e5b-a885-4502-ba66-6d3d1ffe4846" />

A veces se hace necesario crear un índice, para buscar datos que no son la clave primaria, por ejemplo, si se necesitan hacer muchas consultas según la fecha de las encomiendas, entonces se debe crear un índice apuntando a la fecha.


on => Apuntar ahi, sobre esa tabla

```sql
CREATE INDEX INDICE_FECHA ON ENCOMIENDA(FECHA);
```

<img width="353" height="143" alt="image" src="https://github.com/user-attachments/assets/93b33769-af95-4765-8bba-4b99e4b11552" />

Si es que surge la necesidad de buscar por fecha... se utiliza un indice para que sea más rapido

Se puede monitorear si el índice ha sido usado o no. Esto consiste en ejecutar la siguiente instrucción

```sql
-- HABILITAR MONITOREO DE INDICE FECHA
ALTER INDEX INDICE_FECHA MONITORING USAGE;

-- CONSULTAR SI EL INDICE HA SIDO USADO
SELECT * FROM V$OBJECT_USAGE WHERE TABLE_NAME = 'ENCOMIENDA';

-- CONSULTAR POR FECHA
SELECT FECHA FROM ENCOMIENDA WHERE FECHA<'25/10/2023';

-- EJECUTAR NUEVAMENTE SI EL INDICE HA SIDO USADO
SELECT * FROM V$OBJECT_USAGE WHERE TABLE_NAME = 'ENCOMIENDA';

-- PARA DEJAR DE MONITOREAR EL INDICE SE EJECUTA LA SIGUIENTE INSTRUCCION:
ALTER INDEX INDICE_FECHA NOMONITORING USAGE;

```

<img width="590" height="83" alt="image" src="https://github.com/user-attachments/assets/1132b523-cfb6-4a35-9811-2a397973e6a0" />

```SQL
-- PARA ELIMINAR UN INDICE
DROP INDEX INDICE_FECHA;

```
## Ejercicio

Crear un indice asociado al costo. Monitorearlo y comprobar su uso al mostrar los costos ordenados y que sean mayores a 20000

```SQL
CREATE INDEX INDICE_COSTO ON ENCOMIENDA(COSTO);
ALTER INDEX INDICE_COSTO MONITORING USAGE;
SELECT * FROM V$OBJECT_USAGE WHERE TABLE_NAME = 'ENCOMIENDA';
SELECT COSTO FROM ENCOMIENDA WHERE COSTO > 20000 ORDER BY COSTO;
```

## SINÓNIMOS (SYNONYM)
Permita dar un nombre alternativo a un objeto. NO CAMBIA UN NOMBRE. 

Se justifican cuando tenemos objetos (tablas, vistas, etc) con nombres extensos.

> [!TIP]
> [public] Cuando uno trabaja con varios usuarios, se puede dar accedo a un sinonimo a varios usuarios.

```SQL
CREATE SYNONYM TRA FOR TRANSPORTE;
SELECT * FROM TRA;
```

Para ver que sinonimos hay en la base de datos:

```sql
SELECT SYNONYM_NAME, TABLE_NAME FROM ALL_SYNONYMS WHERE OWNER ='SYSTEM';
```

<img width="364" height="266" alt="image" src="https://github.com/user-attachments/assets/2e7d2b07-10aa-493a-bcd4-f5e2073b83e2" />

Ahora crearemos una vista para la tabla encomienda

```SQL
-- CREAMOS LA VISTA CON UN NOMBRE LARGO
CREATE VIEW vistaTotalPorFechas AS SELECT CODENC, FECHA FROM ENCOMIENDA WHERE FECHA BETWEEN '22/10/2023' AND '25/10/2023';

-- SE UTILIZA LA VISTA
SELECT * FROM VISTATOTALPORFECHAS;

-- SE CREA UN SINONIMO
CREATE SYNONYM VIFECH FOR VISTATOTALPORFECHAS;

-- SE UTILIZA EL SINONIMO
SELECT * FROM VIFECH;

-- AMBAS DEVUELVEN LO MISMO, ES UNA COMODIDAD

-- PARA ELIMINAR

DROP SYNONYM TRA;
DROP SYNONYM VIFECH;
```

### EJERCICIO PROPUESTO

- Crear una vista llamada vistaPorMontoMayor, que muestre código, costos y fechas para aquellas encomiendas con costos mayores a 25000.
- Ejecutar la vista
- Crear un sinónimo para este nombre de vista.
- Ejecutar vista con su sinónimo

```SQL
CREATE VIEW vistaPorMontoMayor AS SELECT CODENC, COSTO, FECHA FROM ENCOMIENDA WHERE COSTO > 25000;
SELECT * FROM VISTAPORMONTOMAYOR;
CREATE SYNONYM MONTOMAYOR FOR VISTAPORMONTOMAYOR;
SELECT * FROM MONTOMAYOR;
```

## PRACTICA

- a)	Crear una secuencia para el campo numCons.
- b)	Insertar 8 consumos (usar secuencia).
- c)	Crear una vista para algún select de la tabla consumos.
- d)	Ejecutar la vista creada
- e)	Crear una vista materializada para algún select de la tabla consumos.
- f)	Ejecutar la vista materializada creada.
- g)	Usando el Diccionario de datos, mostrar que vistas ha creado.
- h)	Crear un índice para un campo de la tabla restaurantes.
- i)	Crear un sinónimo para cada una de las tres tablas y las 2 vistas.
- j)	Usando el Diccionario de datos, mostrar que sinónimos ha creado. 
- k)	Probar con un select cada sinónimo.

```SQL
create table restaurantes(
rutRest varchar2(12) not null primary key,
nombreRest varchar2(20),
direccRest varchar2(100),
fonoRest number(15)
);

create table funcionarios(
rutFunc varchar2(12) not null primary key,
nombreFunc varchar2(20),
apPatFunc varchar2(20),
apMatFunc varchar2(20),
fonoFunc number(9)
);

create table consumos(
numCons number(8) not null primary key,
fechaCons date,
CostoCons number(12),
rutRestaurante varchar2(12) not null references restaurantes,
rutFuncionario varchar2(12) not null references funcionarios
);


insert into restaurantes values('6345789-3','Sabores','Colón 742',63758592);
insert into restaurantes values('7237798-8','Miramar','Maipú 636',83740275);
insert into funcionarios values('14034034-4','Roberto','Lara','Carrasco',29384520);
insert into funcionarios values('18000313-2','Lorena','Vera','Coloma',85031809);



-- a)	Crear una secuencia para el campo numCons.

CREATE SEQUENCE SEC_NUMCONS START WITH 1;

-- b)	Insertar 8 consumos (usar secuencia).

INSERT INTO CONSUMOS VALUES(SEC_NUMCONS.NEXTVAL, '01/01/2025', 5000, '6345789-3', '14034034-4');
INSERT INTO CONSUMOS VALUES(SEC_NUMCONS.NEXTVAL, '01/02/2025', 6000, '6345789-3', '14034034-4');
INSERT INTO CONSUMOS VALUES(SEC_NUMCONS.NEXTVAL, '01/03/2025', 7000, '6345789-3', '14034034-4');
INSERT INTO CONSUMOS VALUES(SEC_NUMCONS.NEXTVAL, '01/04/2025', 8000, '6345789-3', '14034034-4');
INSERT INTO CONSUMOS VALUES(SEC_NUMCONS.NEXTVAL, '01/05/2025', 9000, '6345789-3', '14034034-4');
INSERT INTO CONSUMOS VALUES(SEC_NUMCONS.NEXTVAL, '01/06/2025', 10000, '6345789-3', '14034034-4');
INSERT INTO CONSUMOS VALUES(SEC_NUMCONS.NEXTVAL, '01/07/2025', 11000, '6345789-3', '14034034-4');
INSERT INTO CONSUMOS VALUES(SEC_NUMCONS.NEXTVAL, '01/08/2025', 12000, '6345789-3', '14034034-4');

-- c)	Crear una vista para algún select de la tabla consumos.
SELECT MAX(COSTOCONS) FROM CONSUMOS;
SELECT * FROM CONSUMOS;
CREATE VIEW vistaMaxConsumo AS SELECT MAX(COSTOCONS) mayor FROM CONSUMOS;

-- d)	Ejecutar la vista creada

SELECT * FROM VISTAMAXCONSUMO;

-- e)	Crear una vista materializada para algún select de la tabla consumos.
CREATE MATERIALIZED VIEW VISTAMAT_CONSUMO AS SELECT * FROM CONSUMOS;

-- f)	Ejecutar la vista materializada creada.
SELECT * FROM VISTAMAT_CONSUMO;

-- g)	Usando el Diccionario de datos, mostrar que vistas ha creado.
SELECT SEQUENCE_NAME FROM ALL_SEQUENCES WHERE SEQUENCE_NAME LIKE 'SEC%';

-- h)	Crear un índice para un campo de la tabla restaurantes.
CREATE INDEX INDICE_NOMBRE ON RESTAURANTES(NOMBREREST);

-- i)	Crear un sinónimo para cada una de las tres tablas y las 2 vistas.
CREATE SYNONYM REST FOR RESTAURANTES;
CREATE SYNONYM FUNC FOR FUNCIONARIOS;
CREATE SYNONYM CONS FOR CONSUMOS;
CREATE SYNONYM MAXCONS FOR VISTAMAXCONSUMO;
CREATE SYNONYM CONSUMO FOR VISTAMAT_CONSUMO;

-- j)	Usando el Diccionario de datos, mostrar que sinónimos ha creado. 

SELECT * FROM ALL_SYNONYMS WHERE OWNER ='SYSTEM' AND TABLE_OWNER = 'SYSTEM';
-- FILTRE UN POCO MÁS PARA QUE MUESTRE SOLO LO QUE NECESITO

-- k)	Probar con un select cada sinónimo.

SELECT * FROM REST;
SELECT * FROM FUNC;
SELECT * FROM CONS;
SELECT * FROM MAXCONS;
SELECT * FROM CONSUMO;

```
