# VIEWS

Es un select guardado en el Oracle

```SQL
create table transporte(
patente varchar2(6) not null primary key,
marca varchar2(20),
modelo varchar2(20),
color varchar2(15)
);
create table encomienda(
codEnc number(8) not null primary key,
peso number(5),  --en gr
costo number(6),
fecha date,
patenteTransp varchar2(6) not null references transporte
);
insert into transporte values('CTFT45','Ford','Cargo','Blanco');
insert into transporte values('DFGR35','Mercedes Benz','Zetros','Negro');
insert into transporte values('DRTQ87','Renault','Maxity','Blanco');
insert into encomienda values(1,2380,12000,'13/10/2023','CTFT45');
insert into encomienda values(2,1450,35000,'22/10/2023','DFGR35');
insert into encomienda values(3,2130,23000,'25/10/2023','CTFT45');
insert into encomienda values(4,1569,30000,'25/10/2023','DRTQ87');
insert into encomienda values(5,2176,15000,'26/10/2023','DFGR35');

```

```sql
CREATE VIEW vista_costo as SELECT CODENC, COSTO, COSTO*1.19 conIVA from encomienda;

SELECT * FROM vista_costo;
```

conIVA = Es un Alias, cuando un select tiene una formula, debe llevar un Alias.

<img width="234" height="136" alt="image" src="https://github.com/user-attachments/assets/345d723e-0a8c-4076-9d50-1ccbbee51a26" />

Usamos el diccionario de Datos para ver la vista creada

```SQL
SELECT view_name
from user_views
where view_name like 'VISTA%';
```

## Vista Materializada

Es una foto del resultado de la tabla. Son vistas que se quedan con el resultado de manera fija. Ej: Sirve para tener una vista mensual, para tener la tabla en distintos momentos.

```sql
CREATE MATERIALIZED VIEW vistamat_costo as select codenc, costo, costo*1.19 conIVA from encomienda;
SELECT * FROM VISTAMAT_COSTO;
```

## Eliminar una vista

```sql
DROP VIEW VISTA_COSTO;
DROP MATERIALIZED VIEW VISTAMAT_COSTO;
```

### Ejercicio propuesto
Crear una vista que permita mostrar el código de encomienda, y peso para aquellos en que el peso sea mayor a 2000.

Crear una vista materializada que permita mostrar el código de encomienda, peso y costo para aquellos en que el costo esté entre 10000 y 15000

```sql
CREATE VIEW enc_view AS SELECT CODENC, PESO FROM ENCOMIENDA WHERE PESO > 2000;
CREATE MATERIALIZED VIEW VISTAMAT_ENC AS SELECT CODENC, PESO, COSTO FROM ENCOMIENDA WHERE COSTO BETWEEN 10000 AND 15000;
SELECT * FROM ENC_VIEW;
SELECT * FROM VISTAMAT_ENC;
```

## Secuencias
Nos ayudan a crear números correlativos en tablas.

```SQL
-- CREAMOS TABLA
CREATE TABLE PERSONALSUC(
CODPERSONA NUMBER(6) NOT NULL PRIMARY KEY,
CARGO VARCHAR2(20),
FONO NUMBER(11)
)

SINTAXIS:
CREATE SEQUENCE <NOMBRE>
START WITH <VALOR INICIAL>
INCREMENT BY <VALOR DE INCREMENTO>
MAXVALUE <VALOR MÁXIMO>
MINVALUE <VALOR MÍNIMO O INICIAL>

-- CREAMOS LA SECUENCIA
CREATE SEQUENCE SEC_COD START WITH 100;

-- INSERTAMOS Y OCUPAMOS SEC_COD.NEXTVAL PARA ASIGNAR EL CODPERSONA
INSERT INTO PERSONALSUC VALUES(SEC_COD.NEXTVAL, 'Contador', 98877665);
INSERT INTO PERSONALSUC VALUES(SEC_COD.NEXTVAL, 'Asesor', 912345678);

-- REVISAMOS TABLA
SELECT * FROM PERSONALSUC;
```

<img width="321" height="79" alt="image" src="https://github.com/user-attachments/assets/bee7b9a4-d0f4-428a-950e-2049dad59ff2" />

## Para saber en que valor va la secuencia

```SQL

SELECT SEC_COD.CURRVAL FROM DUAL;

SELECT * FROM DUAL;
```

> [!TIP]
> DUAL ES UNA TABLA DUMMY, PARA REALIZAR SELECTS CON TABLAS QUE 'NO EXISTEN'

## CON EL DICCIONARIO DE DATOS, PARA VER SECUENCIAS CREADAS, ESCRIBIR:

```SQL
SELECT SEQUENCE_NAME FROM ALL_SEQUENCES WHERE SEQUENCE_NAME LIKE 'SEC%';
```

<img width="510" height="122" alt="image" src="https://github.com/user-attachments/assets/055696c3-dd28-4e15-9bc0-b1650d5997e5" />

## Eliminar una secuencia

```SQL
DROP SEQUENCE SEC_COD;
```

## EJERCICIOS

Crear la siguiente tabla:

```SQL
CREATE TABLE EQUIPOSVEN(
IDEQUIPO NUMBER(8) NOT NULL PRIMARY KEY,
PESO NUMBER(5,2),
FECHAFABR DATE
);

CREATE SEQUENCE SEC_ID START WITH 20;

INSERT INTO EQUIPOSVEN VALUES(SEC_ID.NEXTVAL, 5, '25/08/25');
INSERT INTO EQUIPOSVEN VALUES(SEC_ID.NEXTVAL, 10, '24/08/25');

SELECT * FROM EQUIPOSVEN;

```
Crear una secuencia para id equipo, que inicie en 10

Insertar 4 registros en la tabla equiposVen, usando la secuencia creada para idEquipo
