
# Unidad 2: Consultas avanzadas en una o más tabla
## Script

```sql
create table Camioneros(
RutCamionero varchar2(12) not null primary key,
NomCam varchar2(20),
ApPatCam varchar2(20),
ApMatCam varchar2(20),
FonoCam varchar2(10),
Sueldo number(9)
);
Create table Camiones(
Patente varchar2(6) not null primary key,
Marca varchar2(20),
Modelo varchar2(20),
Color varchar2(15),
Año number(4)
);
Create table ClienteDestino(
RutCliente varchar2(12) not null primary key,
NomCli varchar2(30),
ApPatCli varchar2(20),
ApMatCli varchar2(20),
FonoCli varchar2(10)
);
Create table Encomiendas(
CodEncomienda number(8) not null primary key,
PesoGr number(5),
Costo number(6),
Ciudad varchar2(30),
FechaEnvio date,
RutCli varchar2(12) not null references clientedestino,
RutCam varchar2(12) not null references camioneros,
Patente varchar2(6) not null references camiones
);

insert into camioneros values('10546789-4','Juan','Lara','Soto','64758999' ,340000);
insert into camioneros values('11328988-0','Mario','Donoso','Vera','53647800',350000);
insert into camioneros values('10324879-3','Luis','Díaz','Castro','43769034',340000);
insert into camioneros values('9678321-7', 'Mario','Donoso','Zapata','32879980',350000);

insert into camiones values('CTFT45','Ford','Cargo','Blanco',2010);
insert into camiones values('DFGR35','Mercedes Benz','Zetros','Negro',2011);
insert into camiones values('DRTQ87','Renault','Maxity','Blanco',2010);

insert into clienteDestino values('12867967-2','Carolina','Riquelme','Duarte','947528596');
insert into clienteDestino values('13437856-1','Eliana','Godoy','Urrutia','939881765');
insert into clienteDestino values('9768345-6','Carlos','Núñez','Torres','965639011');
insert into clienteDestino values('10769800-6','Paula','Millar','Salas','985619675');
insert into clienteDestino values('11341560-k','Marco','Vera','Carrillo','992039100');
insert into clienteDestino values('20900289-2','Lorena','Parra','Mora','945879826');

insert into encomiendas values(1,2380,52000,'Calama','13/10/2023','13437856-1','11328988-0','CTFT45');
insert into encomiendas values(2,1450,75000,'Arica','22/10/2023','12867967-2','10546789-4','DFGR35');
insert into encomiendas values(3,2130,23000,'Curicó','25/10/2023','9768345-6','9678321-7','CTFT45');
insert into encomiendas values(4,1569,30000,'Valdivia','25/10/2023','12867967-2','10324879-3','DRTQ87');
insert into encomiendas values(5,2176,25000,'Santiago','26/10/2023','13437856-1','11328988-0','DFGR35');
insert into encomiendas values(6,3343,28000,'Santiago','27/10/2023','11341560-k','10546789-4','DRTQ87');
insert into encomiendas values(7,2330,28000,'Curicó','3/11/2023','9768345-6','9678321-7','DRTQ87');
insert into encomiendas values(8,5890,56000,'Valdivia','5/11/2023','12867967-2','10324879-3','CTFT45');
insert into encomiendas values(9,8750,65000,'Arica','7/11/2023','12867967-2','11328988-0','DRTQ87');
insert into encomiendas values(10,8906,45000,'Santiago','11/11/2023','10769800-6','10546789-4','CTFT45');
insert into encomiendas values(11,8130,33000,'Curicó','12/11/2023','9768345-6','11328988-0','DRTQ87');
insert into encomiendas values(12,5680,62000,'Calama','13/11/2023','20900289-2','9678321-7','DFGR35');
insert into encomiendas values(13,4530,38000,'Curicó','15/11/2023','9768345-6', '11328988-0','DFGR35');
insert into encomiendas values(14,9890,66000,'Valdivia','17/11/2023','12867967-2','9678321-7','DRTQ87');
insert into encomiendas values(15,3976,45000,'Santiago','17/11/2023','13437856-1','10546789-4','DFGR35');
insert into encomiendas values(16,5460,65000,'Arica','20/11/2023','12867967-2','10546789-4','CTFT45');
insert into encomiendas values(17,5900,67000,'Calama','21/11/2023','20900289-2','9678321-7','CTFT45');
insert into encomiendas values(18,7866,58000,'Curicó','22/11/2023','9768345-6', '11328988-0','DFGR35');
insert into encomiendas values(19,7800,56000,'Valdivia','24/11/2023','12867967-2','9678321-7','CTFT45');
insert into encomiendas values(20,4890,35000,'Santiago','25/11/2023','13437856-1','10546789-4', 'DRTQ87');
insert into encomiendas values(21,7800,75000,'Arica','25/11/2023','12867967-2','9678321-7','CTFT45');
insert into encomiendas values(22,6080,68000,'Calama','26/11/2023','20900289-2','11328988-0','DRTQ87');
insert into encomiendas values(23,8945,64000,'Curicó','27/11/2023','9768345-6','10546789-4','DFGR35');
insert into encomiendas values(24,9800,43000,'Valdivia','28/11/2023','12867967-2','10324879-3','CTFT45');
insert into encomiendas values(25,6800,45000,'Santiago','29/11/2023','13437856-1','11328988-0', 'DRTQ87');

```


## Funciones de una sola fila

### 1) Manipulación de caracteres

Son las funciones que permiten manipular como string(cadenas) los datos de las tablas. 

---

#### Concat
Concatena (une) dos elementos.

Ejemplo:

```sql
SELECT CONCAT('Hoy es ', sysdate) FECHA FROM DUAL;

SELECT CONCAT(MARCA, MODELO) FROM CAMIONES;

SELECT DISTINCT CONCAT('Cliente De Ciudad=', CIUDAD) CLIENTES FROM ENCOMIENDAS;

```

No puede concatenar más de 2 elementos

#### Operador ||

También concatena, y además puede hacerlo con más de dos datos a la vez

```sql

SELECT PATENTE || ' es ' || color || ' y es del año ' || año Camiones from camiones;

SELECT DISTINCT 'El cliente ' || rutcli || ' envio desde ' || ciudad Datos from encomiendas;

SELECT DISTINCT UPPER(CIUDAD) ENVIOS_DESDE FROM ENCOMIENDAS;
```

> ![NOTE]
> El DISTINCT toma todos los campos y hace que no se repitan, en este caso el par de rut y ciudad no se repiten

#### INITCAP

Deja la inicial en Mayuscula

```SQL
SELECT 'El camión ' || initcap(patente) || ' es del año ' || año Dato from camiones;
```

##### LPAD y RPAD

Retorna una cadena de largo n, comenzando desde la cadena1. Si n es mayor que el largo de la cadena1, hace un relleno

L = Left
R = Right

```SQL
SELECT LPAD(FONOCAM, 12, '+569') FONO FROM CAMIONEROS;

SELECT RPAD(PESOGR, 7, ' gr') PESO FROM ENCOMIENDAS;
```

##### TRIM

Le quita el espacio a los textos

```SQL
SELECT TRIM(' PATENTE= ') DATO, PATENTE FROM CAMIONES;
```

##### REPLACE

Reemplaza en pantalla un texto

```SQL
SELECT REPLACE(FECHAENVIO, '/', '-') FECHA, CODENCOMIENDA FROM ENCOMIENDAS;
```

##### SUBSTR

Muestra parte de una cadena, un segmento, un substring

```sql
SELECT SUBSTR(FECHAENVIO, 4,2) MES, CODENCOMIENDA FROM ENCOMIENDAS;
```

### EJERCICIO PROPUESTO

Mostrar fechas y costos de envío del mes de noviembre con el siguiente formato.

```SQL
SELECT 'El día ' || FECHAENVIO || ' se hizo un envio por $' || costo FECHAS_Y_COSTOS from ENCOMIENDAS WHERE fechaenvio LIKE '%/11/%' ORDER BY FECHAENVIO;
```
